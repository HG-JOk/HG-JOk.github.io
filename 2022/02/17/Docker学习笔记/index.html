<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Docker学习笔记 | Joker'S Blog 3.0</title><meta name="keywords" content="Docker,容器技术"><meta name="author" content="Joker"><meta name="copyright" content="Joker"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1 Docker概述1.1 Docker为什么会出现传统：开发jar，运维来做！ 现在：开发打包部署上线，一套流程全做完！ java — apk — 发布(应用商店) — 张三使用apk — 到应用商店下载安装即可！ java — jar(环境) — 打包项目带上环境(镜像) — (Docker仓库：商店) — 下载我们发布的镜像 — 直接运行即可！ Docker给以上的问题，提出了解决方案！ D">
<meta property="og:type" content="article">
<meta property="og:title" content="Docker学习笔记">
<meta property="og:url" content="http://www.liksn.cn/2022/02/17/Docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Joker&#39;S Blog 3.0">
<meta property="og:description" content="1 Docker概述1.1 Docker为什么会出现传统：开发jar，运维来做！ 现在：开发打包部署上线，一套流程全做完！ java — apk — 发布(应用商店) — 张三使用apk — 到应用商店下载安装即可！ java — jar(环境) — 打包项目带上环境(镜像) — (Docker仓库：商店) — 下载我们发布的镜像 — 直接运行即可！ Docker给以上的问题，提出了解决方案！ D">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://static.talkxj.com/articles/a31d598cf1676b21787639326084d918.jpg">
<meta property="article:published_time" content="2022-02-17T02:57:48.000Z">
<meta property="article:modified_time" content="2022-02-17T04:27:46.962Z">
<meta property="article:author" content="Joker">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content="容器技术">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://static.talkxj.com/articles/a31d598cf1676b21787639326084d918.jpg"><link rel="shortcut icon" href="/img/wf.jpg"><link rel="canonical" href="http://www.liksn.cn/2022/02/17/Docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Docker学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-02-17 12:27:46'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/static-butterfly/dist/css/index.min.css"><meta name="generator" content="Hexo 6.0.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://101.43.3.47/static/attach/20220212/f867e104147a450d83f314dcb37f2624.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://static.talkxj.com/articles/a31d598cf1676b21787639326084d918.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Joker'S Blog 3.0</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Docker学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-02-17T02:57:48.000Z" title="发表于 2022-02-17 10:57:48">2022-02-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-02-17T04:27:46.962Z" title="更新于 2022-02-17 12:27:46">2022-02-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">11.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>50分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Docker学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="1-Docker概述"><a href="#1-Docker概述" class="headerlink" title="1 Docker概述"></a>1 Docker概述</h2><h3 id="1-1-Docker为什么会出现"><a href="#1-1-Docker为什么会出现" class="headerlink" title="1.1 Docker为什么会出现"></a>1.1 Docker为什么会出现</h3><p>传统：开发jar，运维来做！</p>
<p>现在：开发打包部署上线，一套流程全做完！</p>
<p>java — apk — 发布(应用商店) — 张三使用apk — 到应用商店下载安装即可！</p>
<p>java — jar(环境) — 打包项目带上环境(镜像) — (Docker仓库：商店) — 下载我们发布的镜像 — 直接运行即可！</p>
<p>Docker给以上的问题，提出了解决方案！</p>
<p>Docker的思想来自集装箱！</p>
<p>JRE — 多个应用(端口冲突) — 原来都是交叉的！</p>
<p>隔离：Docker核心思想！打包装箱！每个箱子都是互相隔离的。通过隔离机制，可以将服务器利用到极致！</p>
<h3 id="1-2-Docker的历史"><a href="#1-2-Docker的历史" class="headerlink" title="1.2 Docker的历史"></a>1.2 Docker的历史</h3><p>Docker刚诞生时，没有引起行业的注意！</p>
<p>2013年，Docker开源，现在越来越多的人发现了Docker的优点，然后就火了，Docker每个月都会更新一个版本！</p>
<p>2014年4月9日，Docker1.0发布！</p>
<p>Docker为什么这么火？十分的轻巧！</p>
<p>在容器技术出来之前，我们都是使用虚拟机技术！</p>
<p>虚拟机：在window中装一个虚拟机软件Vmware，通过这个软件我们可以虚拟出来一个或多个电脑！笨重！虚拟机也是属于虚拟化技术，Docker容器技术，也是一种虚拟化技术！</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vm : linux centos原生镜像(一个电脑！)隔离，需要开启多个虚拟机！几个G   启动需要几分钟</span><br><span class="line">docker : 隔离，镜像(最核心的环境  4m + jdk + mysql)十分的小巧，运行镜像就可以了！小巧！几个M或KB   秒级启动</span><br></pre></td></tr></table></figure>

<blockquote>
<p>聊聊Docker</p>
</blockquote>
<p>Docker是基于Go语言开发的，开源项目！</p>
<p>官网：<a target="_blank" rel="noopener" href="https://www.docker.com/">https://www.docker.com/</a></p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudyb8cfa84a-9571-4774-9ee7-43badfcfc057.png" alt="img"></p>
<p>文档地址：<a target="_blank" rel="noopener" href="https://docs.docker.com/">https://docs.docker.com/</a></p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy3ae658fd-80fd-4aa1-aebc-5811f6ab0050.png" alt="img"></p>
<p>Docker的文档是超级详细的！</p>
<p>仓库地址：<a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<h3 id="1-3-Docker能干嘛"><a href="#1-3-Docker能干嘛" class="headerlink" title="1.3 Docker能干嘛"></a>1.3 Docker能干嘛</h3><blockquote>
<p>之前的虚拟机技术</p>
</blockquote>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy7c89b5f0-ad91-41f3-ba5c-588d0b48bc30.png" alt="img"></p>
<p>虚拟机技术缺点：</p>
<ol>
<li>资源占用十分多</li>
<li>冗余步骤多</li>
<li>启动很慢</li>
</ol>
<blockquote>
<p>容器化技术</p>
</blockquote>
<p><strong>容器化技术不是模拟的一个完整的操作系统</strong></p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudyeb9396c9-317f-49b6-b529-1505fe8e66b4.png" alt="img"></p>
<p>比较Docker和虚拟机技术的不同：</p>
<ul>
<li>传统虚拟机，虚拟出一条硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件</li>
<li>容器内的应用直接在宿主机的内容，容器是没有自己的内核的，也没有虚拟我们的硬件，所以就轻便了</li>
<li>每个容器间是互相隔离，每个容器内都有一个属于自己的文件系统，互不影响</li>
</ul>
<blockquote>
<p>DevOps（开发、运维）</p>
</blockquote>
<p><strong>应用更快的交付和部署</strong></p>
<p>传统：一堆帮助文档，安装程序</p>
<p>Docker：打包镜像发布测试，一键运行</p>
<p><strong>更便捷的升级和扩缩容</strong></p>
<p>使用了Docker之后，我们部署应用就和搭积木一样！</p>
<p><strong>更简单的系统运维</strong></p>
<p>在容器化之后，我们的开发，测试环境都是高度一致的。</p>
<p><strong>更高效的计算机资源利用</strong></p>
<p>Docker是内核级别的虚拟化，可以在一个物理机上可以运行很多的容器实例！服务器的性能可以被压榨到极致。</p>
<h2 id="2-Docker安装"><a href="#2-Docker安装" class="headerlink" title="2 Docker安装"></a>2 Docker安装</h2><h3 id="2-1-Docker的基本组成"><a href="#2-1-Docker的基本组成" class="headerlink" title="2.1 Docker的基本组成"></a>2.1 Docker的基本组成</h3><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudyfffb9e58-956f-40be-ac1b-3e5e13629f0e.jpg" alt="img"></p>
<p><strong>镜像(image)</strong></p>
<p>Docker镜像就好比是一个模板，可以通过这个模板来创建容器服务，Tomcat镜像==》Run==》Tomcat01容器（提供服务器），通过这个镜像可以创建多个容器（最终服务运行或者项目运行就是在容器中的）。</p>
<p><strong>容器(container)</strong></p>
<p>Docker利用容器技术，独立运行一个或者一个组应用，通过镜像来创建的。</p>
<p>启动、停止、删除、基本命令！</p>
<p>目前就可以把这个容器理解为就是一个简易的Linux系统</p>
<p><strong>仓库(repository)</strong></p>
<p>仓库就是存放镜像的地方！</p>
<p>仓库分为共有仓库和私有仓库！</p>
<p>Docker Hub</p>
<p>阿里云都有容器服务器（配置镜像加速）</p>
<h3 id="2-2-安装Docker-适用于VMware"><a href="#2-2-安装Docker-适用于VMware" class="headerlink" title="2.2 安装Docker(适用于VMware)"></a>2.2 安装Docker(适用于VMware)</h3><blockquote>
<p>环境准备</p>
</blockquote>
<p>1、需要会一点点的Linux基础</p>
<p>2、CentOS7</p>
<p>3、使用Xshell连接远程服务器进行操作</p>
<blockquote>
<p>环境查看</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">系统内核是 3.10 以上的</span></span><br><span class="line">[root@iZ2zegy1k4araknrzdo982Z ~]# uname -r</span><br><span class="line">4.19.34-11.al7.x86_64</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">系统版本</span></span><br><span class="line">[root@iZ2zegy1k4araknrzdo982Z ~]# cat /etc/os-release</span><br><span class="line">NAME=&quot;Aliyun Linux&quot;</span><br><span class="line">VERSION=&quot;2.1903 (Hunting Beagle)&quot;</span><br><span class="line">ID=&quot;alinux&quot;</span><br><span class="line">ID_LIKE=&quot;rhel fedora centos&quot;</span><br><span class="line">VERSION_ID=&quot;2.1903&quot;</span><br><span class="line">PRETTY_NAME=&quot;Aliyun Linux 2.1903 (Hunting Beagle)&quot;</span><br><span class="line">ANSI_COLOR=&quot;0;31&quot;</span><br><span class="line">HOME_URL=&quot;https://www.aliyun.com/&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>安装</p>
</blockquote>
<ul>
<li>帮助文档</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">1、卸载旧的版本</span></span><br><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br><span class="line"><span class="meta"># </span><span class="language-bash">2、需要的安装包</span></span><br><span class="line">yum install -y yum-utils</span><br><span class="line"><span class="meta"># </span><span class="language-bash">3、设置镜像的仓库</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo   # 默认是国外的，很慢！！！</span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo  # 推荐使用阿里云的，十分快</span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.tuna.tsinghua.edu.cn/</span><br><span class="line"><span class="meta"># </span><span class="language-bash">更新yum软件包索引</span></span><br><span class="line">yum makecache fast</span><br><span class="line"><span class="meta"># </span><span class="language-bash">4、安装docker相关引擎       docker-ce  社区版     docker-ee  企业版</span></span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="meta"># </span><span class="language-bash">5、启动docker</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="meta"># </span><span class="language-bash">6、使用docker version查看是否安装成功</span></span><br><span class="line">docker version</span><br></pre></td></tr></table></figure>

<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudya7a24305-8b6f-45ac-8114-6bdac0bcaff6.png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">7、hello-world</span></span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>

<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy9ffa2873-4fa7-4b91-9b2e-37341a12a305.jpg" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">8、查看一下下载的这个hello-world镜像</span></span><br><span class="line">docker images</span><br></pre></td></tr></table></figure>

<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy3735ff26-eb64-4cf6-9c15-c3ef81f9d482.png" alt="img"></p>
<h3 id="2-3-卸载Docker"><a href="#2-3-卸载Docker" class="headerlink" title="2.3 卸载Docker"></a>2.3 卸载Docker</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">1、卸载依赖</span></span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="meta"># </span><span class="language-bash">2、删除资源</span></span><br><span class="line">rm -rf /var/lib/docker</span><br><span class="line"><span class="meta"># </span><span class="language-bash">   /var/lib/docker     docker的默认工作路径！！！</span></span><br></pre></td></tr></table></figure>

<h3 id="2-4-阿里云镜像加速"><a href="#2-4-阿里云镜像加速" class="headerlink" title="2.4 阿里云镜像加速"></a>2.4 阿里云镜像加速</h3><p>1.登录阿里云，找到容器镜像服务</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy5da1d524-c943-40dc-a186-cca476f38912.png" alt="img"></p>
<p>2.找到镜像加速地址</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy8fd2c906-3195-4350-98be-0bd8ab036ece.png" alt="镜像加速地址"></p>
<p>3.配置使用</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">1、新建一个目录</span></span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"><span class="meta"># </span><span class="language-bash">2、编译配置文件</span></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://vp85ggug.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"><span class="meta"># </span><span class="language-bash">3、重启该服务</span></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"><span class="meta"># </span><span class="language-bash">4、重启docker</span></span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="2-5-回顾Hello-World流程"><a href="#2-5-回顾Hello-World流程" class="headerlink" title="2.5 回顾Hello World流程"></a>2.5 回顾Hello World流程</h3><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy39693217-6fc3-4cf1-92f7-15bf02677829.jpg" alt="img"></p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy96b95d92-dd59-456d-a95b-769219ad9d0a.png" alt="run的运行流程图"></p>
<h3 id="2-6-底层原理"><a href="#2-6-底层原理" class="headerlink" title="2.6 底层原理"></a>2.6 底层原理</h3><blockquote>
<p>Docker是怎么工作的？</p>
</blockquote>
<p>Docker是一个Client-Server结构的系统，Docker的守护进程运行在主机上。通过Socket从客户端访问，DockerServer接收到Docker-Client的指令，就会执行这个命令！</p>
<blockquote>
<p>Docker为什么比虚拟机快？</p>
</blockquote>
<ul>
<li>Docker有着比虚拟机更少的抽象层</li>
<li>Docker利用的是宿主机的内核，虚拟机需要的是Guest OS</li>
<li>所以说，新建一个容器的时候，Docker不需要像虚拟机一样重新加载一个操作系统内核，避免引导。虚拟机是加载Guest OS，分钟级别的；而Docker是利用宿主机的操作系统，省略了这个复杂的过程，秒级的</li>
</ul>
<h2 id="3-Docker的常用命令"><a href="#3-Docker的常用命令" class="headerlink" title="3 Docker的常用命令"></a>3 Docker的常用命令</h2><h3 id="3-1-帮助命令和文档"><a href="#3-1-帮助命令和文档" class="headerlink" title="3.1 帮助命令和文档"></a>3.1 帮助命令和文档</h3><blockquote>
<p>帮助命令</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker version    # 显示Docker的版本信息</span><br><span class="line">docker info         # 显示Docker的系统信息，包括镜像和容器的数量</span><br><span class="line">docker 命令 --help      # 帮助命令，可以查看Docker的所有命令</span><br></pre></td></tr></table></figure>

<blockquote>
<p>帮助文档的地址</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></p>
<h3 id="3-2-镜像命令"><a href="#3-2-镜像命令" class="headerlink" title="3.2 镜像命令"></a>3.2 镜像命令</h3><p>+ docker images：查看所有本地的主机上的镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">hello-world   latest    d1165f221234   6 months ago   13.3kB</span><br><span class="line"><span class="meta"># </span><span class="language-bash">解释</span></span><br><span class="line">REPOSITORY   镜像的仓库源</span><br><span class="line">TAG                 镜像的标签</span><br><span class="line">IMAGE ID        镜像的ID</span><br><span class="line">CREATED         镜像的创建时间</span><br><span class="line">SIZE                 镜像的大小</span><br><span class="line"><span class="meta"># </span><span class="language-bash">可选项</span></span><br><span class="line">-a,  --all            # 列出所有镜像</span><br><span class="line">-q,  --quiet       # 只显示镜像的ID</span><br></pre></td></tr></table></figure>

<p>+ docker search：搜索镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker search mysql</span><br><span class="line">NAME                                    DESCRIPTION                                 STARS    OFFICIAL     AUTOMATED</span><br><span class="line">mysql                                     MySQL is a widely used,…             11385     [OK]       </span><br><span class="line">mariadb                                 MariaDB Server is a high…             4319      [OK]       </span><br><span class="line">mysql/mysql-server               Optimized MySQL Server…            846                           [OK]</span><br><span class="line">percona                                  Percona Server is a fork…              551        [OK]       </span><br><span class="line">phpmyadmin                         phpMyAdmin - A web…                 314        [OK]       </span><br><span class="line">centos/mysql-57-centos7     MySQL 5.7 SQL database server     91                </span><br><span class="line">... ... ...                                     ... ... ...                                               ... ...        ... ... ...          ... ... ...</span><br><span class="line"><span class="meta"># </span><span class="language-bash">可选项，通过搜藏来过滤</span></span><br><span class="line">--filter=STARS=3000             # 搜索出来的镜像就是STARS大于3000的</span><br></pre></td></tr></table></figure>

<p>+ docker pull：下载镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">下载镜像  docker pull 镜像名[:tag]</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker pull mysql</span><br><span class="line">Using default tag: latest                    # 如果不写tag，默认就是latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">a330b6cecb98: Pull complete           # 分层下载，docker image的核心，联合文件系统</span><br><span class="line">9c8f656c32b8: Pull complete </span><br><span class="line">88e473c3f553: Pull complete </span><br><span class="line">062463ea5d2f: Pull complete </span><br><span class="line">daf7e3bdf4b6: Pull complete </span><br><span class="line">1839c0b7aac9: Pull complete </span><br><span class="line">cf0a0cfee6d0: Pull complete </span><br><span class="line">1b42041bb11e: Pull complete </span><br><span class="line">10459d86c7e6: Pull complete </span><br><span class="line">b7199599d5f9: Pull complete </span><br><span class="line">1d6f51e17d45: Pull complete </span><br><span class="line">50e0789bacad: Pull complete </span><br><span class="line">Digest: sha256:99e0989e7e3797cfbdb8d51a19d32c8d286dd8862794d01a547651a896bcf00c      # 签名</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest            # 真实地址</span><br><span class="line"><span class="meta"># </span><span class="language-bash">等价于它</span></span><br><span class="line">docker pull mysql</span><br><span class="line">docker pull docker.io/library/mysql:latest  </span><br><span class="line"><span class="meta"># </span><span class="language-bash">指定版本下载</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">a330b6cecb98: Already exists </span><br><span class="line">9c8f656c32b8: Already exists </span><br><span class="line">88e473c3f553: Already exists </span><br><span class="line">062463ea5d2f: Already exists </span><br><span class="line">daf7e3bdf4b6: Already exists </span><br><span class="line">1839c0b7aac9: Already exists </span><br><span class="line">cf0a0cfee6d0: Already exists </span><br><span class="line">fae7a809788c: Pull complete </span><br><span class="line">dae5a82a61f0: Pull complete </span><br><span class="line">7063da9569eb: Pull complete </span><br><span class="line">51a9a9b4ef36: Pull complete </span><br><span class="line">Digest: sha256:d9b934cdf6826629f8d02ea01f28b2c4ddb1ae27c32664b14867324b3e5e1291</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br></pre></td></tr></table></figure>

<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy5f33bde9-1d5c-4c31-b550-abc2a7093228.png" alt="img"></p>
<p>+ docker rmi -f：删除镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">根据ID删除指定镜像</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker rmi -f 1d7aba917169</span><br><span class="line"><span class="meta"># </span><span class="language-bash">删除多个镜像</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker rmi -f 镜像id 镜像id 镜像id 镜像id</span><br><span class="line"><span class="meta"># </span><span class="language-bash">删除全部的镜像</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker rmi -f $(docker images -aq)</span><br></pre></td></tr></table></figure>

<h3 id="3-3-容器命令"><a href="#3-3-容器命令" class="headerlink" title="3.3 容器命令"></a>3.3 容器命令</h3><p>说明：我们有了镜像才可以创建容器，Linux，下载一个Centos镜像来测试学习</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure>

<p>- 新建容器并启动</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run [可选参数] image</span><br><span class="line"><span class="meta"># </span><span class="language-bash">参数说明</span></span><br><span class="line">--name=&quot;Name&quot;     容器名字，用来区分容器</span><br><span class="line">-d                             后台方式运行</span><br><span class="line">-it                             使用交互方式运行，进入容器查看内容</span><br><span class="line">-p                             指定容器的端口  -p    8080:8080</span><br><span class="line">    -p ip:主机端口:容器端口</span><br><span class="line">    -p  主机端口:容器端口</span><br><span class="line">    -p  容器端口</span><br><span class="line">    容器端口</span><br><span class="line">-P                             随机指定端口</span><br><span class="line"><span class="meta"># </span><span class="language-bash">测试，启动并进入容器</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker run -it centos /bin/bash</span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看容器内的centos，基础版本，很多命令都是不完善的</span></span><br><span class="line">[root@27138e607d88 /]# ls             </span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br></pre></td></tr></table></figure>

<p>- 退出容器，从容器中退出主机</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@27138e607d88 /]# exit</span><br><span class="line">exit</span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# ls</span><br><span class="line">env.txt  sa_recovery.log</span><br></pre></td></tr></table></figure>

<p>- 列出运行的容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">docker ps：列出当前正在运行的容器</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"><span class="meta"># </span><span class="language-bash">docker ps -a：列出当前正在运行的容器+历史运行过的容器</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED         STATUS                     PORTS     NAMES</span><br><span class="line">27138e607d88   centos         &quot;/bin/bash&quot;   6 minutes ago   Exited (0) 2 minutes ago             nifty_knuth</span><br><span class="line">a9d2bde35c33   d1165f221234   &quot;/hello&quot;      2 hours ago     Exited (0) 2 hours ago               tender_cori</span><br><span class="line"><span class="meta"># </span><span class="language-bash">docker ps -a -n=?：显示最近创建的?个容器</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker ps -a -n=1</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS                     PORTS     NAMES</span><br><span class="line">27138e607d88   centos    &quot;/bin/bash&quot;   8 minutes ago   Exited (0) 3 minutes ago             nifty_knuth</span><br><span class="line"><span class="meta"># </span><span class="language-bash">docker ps -q：只显示容器的编号</span></span><br></pre></td></tr></table></figure>

<p>- 退出容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">exit                     # 直接容器停止并退出</span><br><span class="line">Ctrl + P + Q       # 容器不停止退出</span><br></pre></td></tr></table></figure>

<p>- 删除容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker rm 容器id                             # 删除指定的容器，不能删除正在运行的容器，如果要强制删除就是rm -f</span><br><span class="line">docker rm -f $(docker ps -aq)         # 删除所有的容器</span><br><span class="line">docker ps -a -q|xargs docker rm     # 删除所有容器</span><br></pre></td></tr></table></figure>

<p>- 启动和停止容器的操作</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker start 容器id              # 启动容器</span><br><span class="line">docker restart 容器id           # 停止容器</span><br><span class="line">docker stop 容器id              # 停止当前正在运行的容器</span><br><span class="line">docker kill 容器id                 # 强制停止当前容器</span><br></pre></td></tr></table></figure>

<h3 id="3-4-常用其他命令"><a href="#3-4-常用其他命令" class="headerlink" title="3.4 常用其他命令"></a>3.4 常用其他命令</h3><p>* 后台启动容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">命令 docker run -d 镜像名</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker run -d centos</span><br><span class="line">b2766d3656270d6e24a3ccb7b8a72607e62367955e07e103f588709bdb9c9533</span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"><span class="meta"># </span><span class="language-bash">问题docker ps，发现centos停止了</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">常见的坑，docker容器使用后台运行，就必须要有一个前台进程，docker发现没有应用，就会自动停止</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">nginx，容器启动后，发现自己没有提供服务，就会立刻停止，就是没有程序了</span></span><br></pre></td></tr></table></figure>

<p>* 查看日志命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker logs -f -t --tail         容器，没有日志</span><br><span class="line"><span class="meta"># </span><span class="language-bash">自己编写一段shell脚本</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker run -d centos /bin/sh -c &quot;while true; do echo kuangshen;sleep 1;done&quot;</span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     </span><br><span class="line">2382115c04e3   centos  </span><br><span class="line"><span class="meta"># </span><span class="language-bash">显示日志</span></span><br><span class="line">-tf                       # 显示日志</span><br><span class="line">--tail number     # 要显示日志条数</span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker logs -tf --tail 10 2382115c04e3</span><br></pre></td></tr></table></figure>

<p>* 查看容器中进程信息 ps</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">命令   docker top 容器<span class="built_in">id</span></span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker top 2382115c04e3</span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 </span><br><span class="line">root                20227               20164               0                   13:38               ?                  </span><br><span class="line">root                22455               20227               0                   13:50               ?</span><br></pre></td></tr></table></figure>

<p>* 查看镜像的元数据</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">命令</span></span><br><span class="line">docker inspect 容器id</span><br><span class="line"><span class="meta"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z ~]# docker inspect 2382115c04e3</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;2382115c04e3a04be0a3314d0a5ebd894118870a5ee7c4c717c2861feb740c8a&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-09-09T05:38:12.324834866Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/sh&quot;,</span><br><span class="line">        &quot;Args&quot;: [</span><br><span class="line">            &quot;-c&quot;,</span><br><span class="line">            &quot;while true; do echo kuangshen;sleep 1;done&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 20227,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2021-09-09T05:38:12.654779332Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/2382115c04e3a04be0a3314d0a5ebd894118870a5ee7c4c717c2861feb740c8a/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/2382115c04e3a04be0a3314d0a5ebd894118870a5ee7c4c717c2861feb740c8a/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/2382115c04e3a04be0a3314d0a5ebd894118870a5ee7c4c717c2861feb740c8a/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/2382115c04e3a04be0a3314d0a5ebd894118870a5ee7c4c717c2861feb740c8a/2382115c04e3a04be0a3314d0a5ebd894118870a5ee7c4c717c2861feb740c8a-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/focused_brattain&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;CgroupnsMode&quot;: &quot;host&quot;,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/ea0d40625eb312b3b786ba8591392cfaa7fcccac2342fbaffaf61e193a97ef10-init/diff:/var/lib/docker/overlay2/ae7ea40a5f676425498a213d349a33ae47279e6d967ca8ae68899fc318f4c691/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/ea0d40625eb312b3b786ba8591392cfaa7fcccac2342fbaffaf61e193a97ef10/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/ea0d40625eb312b3b786ba8591392cfaa7fcccac2342fbaffaf61e193a97ef10/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/ea0d40625eb312b3b786ba8591392cfaa7fcccac2342fbaffaf61e193a97ef10/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;2382115c04e3&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/sh&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;while true; do echo kuangshen;sleep 1;done&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20201204&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;3514405b5fa58af8745f6b646c42d14f63ec74f107d837f7f6b6b48f46cdcc6c&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/3514405b5fa5&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;0762e65693b6ee4a767c06ab4fa9f1c17177dd780c0bb08e0161995cb7ed94b2&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;d1738173ad84d5e4070c432a2342e7b5f95d1b47733599cc5a368ed2b660280e&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;0762e65693b6ee4a767c06ab4fa9f1c17177dd780c0bb08e0161995cb7ed94b2&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>* 进入当前正在运行的容器</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">我们通常容器都是使用后台方式运行的，需要进入容器，修改一些配置</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">命令</span></span><br><span class="line">docker exec -it 容器id /bin/bash</span><br><span class="line"><span class="meta"># </span><span class="language-bash">方式二</span></span><br><span class="line">docker attach 容器id</span><br><span class="line"><span class="meta"># </span><span class="language-bash">docker <span class="built_in">exec</span>         <span class="comment"># 进入容器后开启一个新的终端，可以在里面操作（常用）</span></span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">docker attach      <span class="comment"># 进入容器正在执行的终端，不会启动新的进程！</span></span></span><br></pre></td></tr></table></figure>

<p>* <strong>从容器内拷贝文件到主机上</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker cp 容器id：容器内路径   目的的主机路径</span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看当前主机目录下</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z home]# ls</span><br><span class="line">admin  iz2zegy1k4araknrzdo982z.java  staragent  www</span><br><span class="line">[root@iz2zegy1k4araknrzdo982z home]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS         PORTS     NAMES</span><br><span class="line">07aec6b1e909   centos    &quot;/bin/bash&quot;   4 minutes ago   Up 4 minutes             vigilant_moore</span><br><span class="line"><span class="meta"># </span><span class="language-bash">进入docker容器内部</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z home]# docker attach 07aec6b1e909</span><br><span class="line">[root@07aec6b1e909 ~]# cd /home</span><br><span class="line">[root@07aec6b1e909 home]# ls</span><br><span class="line"><span class="meta"># </span><span class="language-bash">在容器内新建一个文件</span></span><br><span class="line">[root@07aec6b1e909 home]# touch test.java</span><br><span class="line">[root@07aec6b1e909 home]# exit</span><br><span class="line">exit</span><br><span class="line">[root@iz2zegy1k4araknrzdo982z home]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@iz2zegy1k4araknrzdo982z home]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS                      PORTS     NAMES</span><br><span class="line">07aec6b1e909   centos    &quot;/bin/bash&quot;   5 minutes ago   Exited (0) 15 seconds ago             vigilant_moore</span><br><span class="line"><span class="meta"># </span><span class="language-bash">将这个文件拷贝出来到主机上</span></span><br><span class="line">[root@iz2zegy1k4araknrzdo982z home]# docker cp 07aec6b1e909:/home/test.java /home</span><br><span class="line">[root@iz2zegy1k4araknrzdo982z home]# ls</span><br><span class="line">admin  iz2zegy1k4araknrzdo982z.java  staragent  test.java  www</span><br><span class="line">[root@iz2zegy1k4araknrzdo982z home]# </span><br><span class="line"><span class="meta"># </span><span class="language-bash">拷贝是一个手动过程，未来使用 -v 卷的技术可以做到</span></span><br></pre></td></tr></table></figure>

<h3 id="3-5-作业练习"><a href="#3-5-作业练习" class="headerlink" title="3.5 作业练习"></a>3.5 作业练习</h3><blockquote>
<p>Docker安装Nginx</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">1、搜索镜像          search         建议大家去docker搜索，可以看到帮助文档</span></span><br><span class="line">docker search nginx</span><br><span class="line"><span class="meta"># </span><span class="language-bash">2、下载镜像          pull</span></span><br><span class="line">docker pull nginx</span><br><span class="line"><span class="meta"># </span><span class="language-bash">3、运行测试</span></span><br><span class="line">[root@localhost /]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">nginx              latest    f652ca386ed1   12 days ago    141MB</span><br><span class="line">centos            latest    5d0da3dc9764   2 months ago   231MB</span><br><span class="line"><span class="meta"># </span><span class="language-bash">-d   后台运行</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">--name   给容器命名</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">宿主机端口:容器内部端口</span></span><br><span class="line">[root@localhost /]# docker run -d --name nginx01 -p 3344:80 nginx</span><br><span class="line">b2f976d2f0636b64dce4cfd43661a978a82a3f53ae3ba127dda9861ad01f9681</span><br><span class="line">[root@localhost /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS            NAMES</span><br><span class="line">b2f976d2f063   nginx     &quot;/docker-entrypoint.…&quot;   4 seconds ago   Up 4 seconds   0.0.0.0:3344-&gt;80/tcp, :::3344-&gt;80/tcp   nginx01</span><br><span class="line"><span class="meta"># </span><span class="language-bash">4、本机测试</span></span><br><span class="line">[root@localhost /]# curl localhost:3344</span><br><span class="line"><span class="meta"># </span><span class="language-bash">5、外网访问</span></span><br><span class="line">http://192.168.22.129:3344</span><br><span class="line"><span class="meta"># </span><span class="language-bash">6、进入容器</span></span><br><span class="line">[root@localhost /]# docker exec -it nginx01 /bin/bash</span><br><span class="line">root@b2f976d2f063:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@b2f976d2f063:/# cd /etc/nginx</span><br><span class="line">root@b2f976d2f063:/etc/nginx# ls</span><br><span class="line">conf.d        mime.types  nginx.conf     uwsgi_params     fastcgi_params    modules     scgi_params</span><br><span class="line"><span class="meta"># </span><span class="language-bash">退出容器</span></span><br><span class="line">root@b2f976d2f063:/etc/nginx# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta"># </span><span class="language-bash">停止docker容器</span></span><br><span class="line">[root@localhost /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS          NAMES</span><br><span class="line">b2f976d2f063   nginx     &quot;/docker-entrypoint.…&quot;   22 minutes ago   Up 22 minutes   0.0.0.0:3344-&gt;80/tcp, :::3344-&gt;80/tcp   nginx01</span><br><span class="line">[root@localhost /]# docker stop b2f976d2f063</span><br><span class="line">b2f976d2f063</span><br></pre></td></tr></table></figure>

<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudyff456e2e-cb9b-45ff-afd4-88d1c2f6e50b.png" alt="img"></p>
<p>- 思考问题：每次改动nginx配置文件，都需要进入容器内部，若可以在容器外部提供一个映射路径，若容器外修改，那么容器内可以自动修改—— <strong>-v 数据卷</strong></p>
<blockquote>
<p>Docker安装Tomcat</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">官方的使用</span></span><br><span class="line">docker run -it --rm tomcat:9.0</span><br><span class="line"><span class="meta"># </span><span class="language-bash">之前的启动都是后台，停止了容器之后，容器还是可以查到。docker run -it --<span class="built_in">rm</span>，一般用来测试，用完就删除</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">先下载再启动</span></span><br><span class="line">docker pull tomcat</span><br><span class="line"><span class="meta"># </span><span class="language-bash">启动运行</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">-d   后台运行</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">--name   给容器命名</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">宿主机端口:容器内部端口</span></span><br><span class="line">docker run -d -p 3355:8080 --name tomcat01 tomcat</span><br><span class="line"><span class="meta"># </span><span class="language-bash">测试访问没有问题</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">进入容器</span></span><br><span class="line">[root@localhost ~]# docker exec -it tomcat01 /bin/bash</span><br><span class="line"><span class="meta"># </span><span class="language-bash">发现问题，linux命令少了，没有webapps，阿里云镜像的原因，默认是最小的镜像，所有不必要的都剔除了</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">文件都在webapps.dist中，将webapps.dist中的文件拷贝到webapps中</span></span><br><span class="line">root@f0cfd5823fc5:/usr/local/tomcat/webapps# cp -r webapps.dist/* webapps</span><br><span class="line"><span class="meta"># </span><span class="language-bash">外网可以访问</span></span><br><span class="line">http://192.168.22.129:3355/</span><br></pre></td></tr></table></figure>

<p>- 思考问题：以后部署项目，每次都要进入容器十分麻烦。若可以在容器外部提供一个映射路径，webapps，在外部放置项目，自动同步到内部就好了。</p>
<blockquote>
<p>部署es + kibana</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">es 暴露的端口很多且十分耗内存</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">es 的数据一般需要放置到安全目录</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">--net somenetwork     网络配置</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">启动elasticsearch</span></span><br><span class="line">docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2</span><br><span class="line"><span class="meta"># </span><span class="language-bash">启动后linux都变卡了     docker stats——查看CPU的状态</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">es是十分耗内存的，一点几个G</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">停止tomcat</span></span><br><span class="line">docker stop tomcatID</span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看docker stats</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">测试一下es是否成功</span></span><br><span class="line">curl localhost:9200</span><br><span class="line"><span class="meta"># </span><span class="language-bash">成功后关闭，增加内存限制——修改配置文件   -e   环境配置文件修改</span></span><br><span class="line">docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; elasticsearch:7.6.2</span><br></pre></td></tr></table></figure>

<h2 id="4-Portainer可视化面板安装"><a href="#4-Portainer可视化面板安装" class="headerlink" title="4 Portainer可视化面板安装"></a>4 Portainer可视化面板安装</h2><blockquote>
<p>什么是Portainer？</p>
</blockquote>
<p>Docker图形化界面管理工具！提供一个后台面板供我们操作</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">安装命令</span></span><br><span class="line">docker run -d -p 8088:9000 \</span><br><span class="line">--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br><span class="line"><span class="meta"># </span><span class="language-bash">外网访问</span></span><br><span class="line">http://192.168.22.129:8088</span><br></pre></td></tr></table></figure>

<p>1.输入密码创建用户</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy4541e7d5-cdcb-4aa0-b6ca-5668b3fd48be.jpg" alt="img"></p>
<p>2.选择本地连接</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy27b5f0eb-332b-45ee-8c41-efc5024e9d94.png" alt="img"></p>
<p>3.进入主页</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudyd5732fe5-2233-4cc4-b62b-b9688a898aa7.png" alt="img"></p>
<p>4.这个可视化面板平时不会用，测试玩玩即可</p>
<h2 id="5-Docker镜像讲解"><a href="#5-Docker镜像讲解" class="headerlink" title="5 Docker镜像讲解"></a>5 Docker镜像讲解</h2><h3 id="5-1-镜像是什么"><a href="#5-1-镜像是什么" class="headerlink" title="5.1 镜像是什么"></a>5.1 镜像是什么</h3><p>镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件。</p>
<p><strong>所有应用，直接打包成Docker镜像，就能直接跑起来。</strong></p>
<blockquote>
<p>如何得到镜像？</p>
</blockquote>
<ul>
<li>从远程仓库下载</li>
<li>别人拷贝</li>
<li>自己制作一个镜像DockerFile</li>
</ul>
<h3 id="5-2-Docker镜像加载原理"><a href="#5-2-Docker镜像加载原理" class="headerlink" title="5.2 Docker镜像加载原理"></a>5.2 Docker镜像加载原理</h3><blockquote>
<p>UnionFS(联合文件系统)</p>
</blockquote>
<p>UnionFS(联合文件系统)：Union文件系统(UnionFS)是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a single virtual filesystem)。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像(没有父镜像)，可以制作各种具体的应用镜像。</p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
<blockquote>
<p>Docker镜像加载原理</p>
</blockquote>
<p>Docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。</p>
<p>Bootfs(Boot File System)主要包含bootloader和kernel，bootloader主要是引导加载kernel，Linux刚启动时会加载Bootfs文件系统，在Docker镜像的最底层是Bootfs。这一层与我们典型的Linux&#x2F;Unix系统是一样的，包含Boot加载器和内核。当Boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由Bootfs转交给内核，此时系统也会卸载Bootfs。</p>
<p>Rootfs(Root File System)，在Bootfs之上。包含的就算典型Linux系统中的&#x2F;dev，&#x2F;proc，&#x2F;bin，&#x2F;etc等标准目录和文件。Rootfs就是各种不同的操作系统发行版，比如Ubuntu，Centos等等。</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudydeba71bc-9e4f-418b-8f64-8518097d8f4a.png" alt="img"></p>
<p>平时安装进虚拟机的CentOS都是好几个G，为什么Docker里才200M？</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy789c880c-2be2-4442-b200-3dfccfa059e8.png" alt="img"></p>
<p>对于一个精简的OS，Rootfs可以很小，只需要包含最基本的命令，工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供Rootfs就可以了。由此可见对于不同的Linux发行版，Bootfs基本是一致是，Rootfs会有差别，因此不同的发行版可以公用Bootfs。</p>
<h3 id="5-3-分层理解"><a href="#5-3-分层理解" class="headerlink" title="5.3 分层理解"></a>5.3 分层理解</h3><blockquote>
<p>分层的镜像</p>
</blockquote>
<p>下载一个镜像，注意观察下载的日志输出，可以看到是一层一层的在下载。</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy3a911a14-9b4e-41d9-aed9-c9977edba1f7.png" alt="img"></p>
<p>- 思考：为什么Docker镜像要采用这种分层的结构呢？</p>
<p>最大的好处是资源共享，比如有多个镜像都从相同的Base镜像构建而来，那么宿主机只需在磁盘上保留一份Base镜像，同时内存中也只需要加载一份Base镜像，这样就可以为所有的容器服务了，而且镜像的每一层都可以被共享。</p>
<p>查看镜像分层的方式可以通过<code>docker image inspect</code>命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# docker image inspect redis:latest</span><br><span class="line">[</span><br><span class="line">    // ... ...</span><br><span class="line">        &quot;RootFS&quot;: &#123;</span><br><span class="line">            &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">            &quot;Layers&quot;: [</span><br><span class="line">                &quot;sha256:9321ff862abbe8e1532076e5fdc932371eff562334ac86984a836d77dfb717f5&quot;,</span><br><span class="line">                &quot;sha256:aa2858ea5edc9c0981901a1b63b49a8f4a6e7099b4304b49e680ffdcc6b71b3e&quot;,</span><br><span class="line">                &quot;sha256:93079bf13a6d5fe7c4bd9f00cb96183f9d1db9968c4bd15b395df2f3867bf8e5&quot;,</span><br><span class="line">                &quot;sha256:9ca504b88e256aa6f6c04ec65aeeed6b926661ea30a0b97f829fbe230155241a&quot;,</span><br><span class="line">                &quot;sha256:9468a3f0498bd5cc298ce25ea6ce9c6adf14aa2ce152856b5f389510a9bb9e01&quot;,</span><br><span class="line">                &quot;sha256:b7851a62867d82784052d7662862adc0b47b2bddcddc89ae78307f75ba1b29ae&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Metadata&quot;: &#123;</span><br><span class="line">            &quot;LastTagTime&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><strong>理解：</strong></p>
<p>所有的Docker镜像都起始于一个基础镜像层，当进行修改或增加新内容时，就会在当前镜像层之上，创建新的镜像层。</p>
<p>例如，假如基于Ubuntu Linux16.04创建一个新的镜像，这就是新镜像的第一层；如果在该镜像中添加Python包，就会在基础镜像层之上创建第二个镜像层；如果继续添加一个安全补丁，就会创建第三个镜像层。</p>
<p>该镜像当前已经包含3个镜像层，如下图所示（这只是一个用于演示的很简单的例子）。</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy7fbb9de9-d35d-4e7f-96cc-e607bdc589e7.png" alt="img"></p>
<p>在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合，理解这一点非常重要。下图中举了一个简单的例子，每个镜像层包含了3个文件，而镜像包含了来自两个镜像层的6个文件。</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy80640ab7-31da-4e26-aed7-ba8b5b95b4da.png" alt="img"></p>
<p>上图中的镜像层跟之前途中的略有区别，主要目的是便于展示文件。</p>
<p>下图中展示了一个稍微复杂的三层镜像，在外部看来整个镜像只有6个文件，这是因为上层中的文件7是文件5的一个更新版本。</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudy516b0ce6-4530-4181-aae8-f6ce4252a9bf.png" alt="img"></p>
<p>这种情况下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为一个新镜像层添加到镜像当中。</p>
<p>Docker通过存储引擎（新版本采用快照机制）的方式来实现镜像层堆栈，并保证多镜像层对外展示为统一的文件系统。</p>
<p>Linux上可用的存储引擎有AUFS、Overlay2、Device Mapper、Btrfs以及ZFS。顾名思义，每种存储引擎都基于Linux中对应的文件系统或者块设备技术，并且每种存储引擎都有其独有的性能特点。</p>
<p>Docker在Windows上仅支持windowsfilter一种存储引擎，该引擎基于NTFS文件系统之上实现了分层和CoW。</p>
<p>下图展示了与系统展示相同的三层镜像。所有镜像层堆叠并合并，对外提供统一的视图。</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudya44ceb1e-d988-4ecb-8853-8d22e97ec5a9.png" alt="img"></p>
<blockquote>
<p>特点</p>
</blockquote>
<p>Docker镜像都是只读的，当容器启动的，一个新的可写层被加载到镜像的顶部！</p>
<p>这一层就是我们通常说的容器层，容器之下的都叫镜像层！</p>
<p>如何提交一个自己的镜像——</p>
<h2 id="6-Commit镜像"><a href="#6-Commit镜像" class="headerlink" title="6 Commit镜像"></a>6 Commit镜像</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker commit     提交容器成为一个新的副本</span><br><span class="line"><span class="meta"># </span><span class="language-bash">命令和git类似</span></span><br><span class="line">docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器id 目标镜像名:[TAG]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>实战测试</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">启动一个默认的tomcat</span></span><br><span class="line">docker run -it -p 8080:8080 tomcat</span><br><span class="line"><span class="meta"># </span><span class="language-bash">进入容器</span></span><br><span class="line">docker exec -it dde8846b0c72 /bin/bash</span><br><span class="line"><span class="meta"># </span><span class="language-bash">发现这个默认的tomcat是没有webapps应用，拷贝进去基本的文件</span></span><br><span class="line">cp -r webapps.dist/* webapps</span><br><span class="line"><span class="meta"># </span><span class="language-bash">将操作过的容器通过commit提交为一个新的镜像，以后使用修改过的镜像即可，这是一个修改过的镜像</span></span><br><span class="line">docker commit -a=&quot;candy&quot; -m=&quot;add webapps app&quot; dde8846b0c72 tomcat02:1.0</span><br></pre></td></tr></table></figure>

<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/21/kuangstudyc0d74175-6523-4812-b9d1-5db6b770498d.png" alt="img"></p>
<p>- 方式说明：若想要保存当前容器的状态，就可以通过commit来提交，获得一个镜像。</p>
<h2 id="7-容器数据卷"><a href="#7-容器数据卷" class="headerlink" title="7 容器数据卷"></a>7 容器数据卷</h2><h3 id="7-1-什么是容器数据卷"><a href="#7-1-什么是容器数据卷" class="headerlink" title="7.1 什么是容器数据卷"></a>7.1 什么是容器数据卷</h3><blockquote>
<p>Docker的理念回顾</p>
</blockquote>
<p>将应用和环境打包成一个镜像。</p>
<p>如果数据都在容器中，那么容器删除，数据就会丢失！<strong>需求：数据可以持久化</strong></p>
<p>MySQL，容器删了，删库跑路！<strong>需求：MySQL数据可以存储在本地</strong></p>
<p>容器之间可以有一个数据共享的技术，Docker容器中产生的数据，同步到本地</p>
<p>这就是卷技术，目录的挂载，将容器内的目录，挂载到Linux上面</p>
<p>&#x3D;&#x3D;容器的持久化和同步操作，容器间可以数据共享&#x3D;&#x3D;</p>
<h3 id="7-2-使用数据卷"><a href="#7-2-使用数据卷" class="headerlink" title="7.2 使用数据卷"></a>7.2 使用数据卷</h3><blockquote>
<p>方式一：直接使用命令来挂载 -v</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run -it -v -p 主机端口:容器内端口</span><br><span class="line"><span class="meta"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@localhost ~]# docker run -it -v /home/ceshi:/home centos /bin/bash</span><br><span class="line"><span class="meta"># </span><span class="language-bash">启动起来的时候通过docker inspect 容器<span class="built_in">id</span></span></span><br><span class="line">[root@localhost home]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND        CREATED         STATUS         PORTS                    </span><br><span class="line">ec2791f8641d   centos                &quot;/bin/bash&quot;    2 minutes ago   Up 2 minutes                            n</span><br><span class="line">032a87ad5797   portainer/portainer   &quot;/portainer&quot;   7 hours ago     Up 7 hours     0.0.0.0:8088-&gt;9000/tcp, :enberg</span><br><span class="line">[root@localhost home]# docker inspect ec2791f8641d</span><br></pre></td></tr></table></figure>

<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/27/kuangstudy76f3fc9d-4000-419c-a5a8-67124b550f76.png" alt="数据卷"></p>
<ol>
<li>测试文件同步：同步过程，双向绑定。</li>
</ol>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/27/kuangstudyc65d1509-6e92-4fd9-ab63-e3cc9620238b.png" alt="数据卷"></p>
<ol>
<li>接着测试</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">先停掉容器</span></span><br><span class="line">[root@ec2791f8641d home]# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta"># </span><span class="language-bash">在宿主机中修改test.java</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">重新启动容器，发现虽然之前停止了容器，但是宿主机中修改了，容器中会同步修改</span></span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                  CREATED          STATUS                        PORTS                                       NAMES</span><br><span class="line">ec2791f8641d   centos                &quot;/bin/bash&quot;              25 minutes ago   Exited (0) 4 minutes ago                                                  sharp_robinson</span><br><span class="line">[root@localhost ~]# docker start ec2791f8641d</span><br><span class="line">ec2791f8641d</span><br><span class="line">[root@localhost ~]# docker attach ec2791f8641d</span><br><span class="line">[root@ec2791f8641d /]# cd /home</span><br><span class="line">[root@ec2791f8641d home]# ls</span><br><span class="line">test.java</span><br><span class="line">[root@ec2791f8641d home]# vi test.java</span><br></pre></td></tr></table></figure>

<p>- 好处：以后修改只需要在本地中修改即可，容器内会自动同步。</p>
<h3 id="7-3-安装MySQL"><a href="#7-3-安装MySQL" class="headerlink" title="7.3 安装MySQL"></a>7.3 安装MySQL</h3><p>- 思考：MySQL的数据持久化的问题</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">获取镜像</span></span><br><span class="line">[root@localhost home]# docker pull mysql:5.7</span><br><span class="line"><span class="meta"># </span><span class="language-bash">运行容器，需要做数据挂载</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">安装启动mysql，需要配置密码！！！</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">官方测试</span></span><br><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br><span class="line"><span class="meta"># </span><span class="language-bash">启动</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">-d  后台运行</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">-p  端口映射</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">-v  卷挂载</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">-e  环境配置</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">--name  容器名字</span></span><br><span class="line">[root@localhost home]# docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"><span class="meta"># </span><span class="language-bash">启动成功之后，在本地使用Navicat连接测试</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">Navicat--连接到服务器的3310--3310和容器内的3306映射，这个时候就可以连接上了</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">在本地测试创建一个数据库，查看映射的路径是否同步</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">将容器删除后发现，挂载到本地的数据卷依旧没有丢失，实现了容器数据持久化功能</span></span><br></pre></td></tr></table></figure>

<h3 id="7-4-具名和匿名挂载"><a href="#7-4-具名和匿名挂载" class="headerlink" title="7.4 具名和匿名挂载"></a>7.4 具名和匿名挂载</h3><blockquote>
<p>匿名挂载</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">匿名挂载</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">-v 容器内路径，-P 随机映射端口</span></span><br><span class="line">docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看所有卷volume的情况</span></span><br><span class="line">[root@localhost home]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     99e9e02fb5b08234a3d40f5d681fb6779a358a460c553d3387ef25d4ec4f2491</span><br><span class="line">local     c9ebbbbe6585eb1cd70f951dca8ddf81a7b20a0b55d4c38b950fc2444d6293ad</span><br><span class="line"><span class="meta"># </span><span class="language-bash">没有给卷起名字就是匿名挂载，-v只些了容器内的路径，没有写本地路径</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">具名挂载</span></span><br><span class="line">[root@localhost home]# docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span><br><span class="line">412cf3a4511eb90673dda7018be8343f168481a055cd338f296a64b56c6c912f</span><br><span class="line">[root@localhost home]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     juming-nginx</span><br><span class="line"><span class="meta"># </span><span class="language-bash">通过-v 卷名:容器内路径</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看卷</span></span><br><span class="line">[root@localhost home]# docker volume inspect juming-nginx</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2021-12-15T09:06:57+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/juming-nginx/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;juming-nginx&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>所有的docker容器内的卷，没有指定目录的情况下都是在<code>/var/lib/docker/volumes/xxxx/_data</code></p>
<p>通过具名挂载可以方便地找到一个卷，大多数情况在使用地都是&#x3D;&#x3D;具名挂载&#x3D;&#x3D;</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">如何确定是具名挂载还是匿名挂载，还说指定路径挂载</span></span><br><span class="line">-v 容器内路径                       # 匿名挂载</span><br><span class="line">-v 卷名:容器内路径               # 具名挂载</span><br><span class="line">-v /宿主机路径:容器内路径   # 指定路径挂载</span><br></pre></td></tr></table></figure>

<p>- 拓展：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">通过-v 容器内路径:ro/rw 改变读写权限</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">ro:<span class="built_in">readonly</span>    只读</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">rw:readwrite  可读可写</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">一旦这个设置了容器权限，容器对我们挂载出来的就有限定了</span></span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:ro nginx</span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:rw nginx</span><br><span class="line"><span class="meta"># </span><span class="language-bash">只要看到ro就说明这个路径只能通过宿主机操作，容器内部无法操作</span></span><br></pre></td></tr></table></figure>

<h3 id="7-5-初识Dockerfile"><a href="#7-5-初识Dockerfile" class="headerlink" title="7.5 初识Dockerfile"></a>7.5 初识Dockerfile</h3><p>Dockerfile就是用来构建Docker镜像的构建文件，命令脚本</p>
<p>通过这个脚本可以生成镜像，镜像是一层一层的，脚本一个个的命令，每个命令都是一层</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">创建一个dockerfile文件，文件可以随机，但是建议叫Dockerfile</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">文件中的内容   指令   参数</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">以下为文件内容</span></span><br><span class="line">FROM centos</span><br><span class="line">VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line">CMD echo &quot;----end----&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line">docker bulid -f dockerfile1 -t /candy/centos</span><br><span class="line"><span class="meta"># </span><span class="language-bash">这里的每个命令，就是镜像的一层！</span></span><br></pre></td></tr></table></figure>

<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/27/kuangstudy6f4311b1-bfc9-48f9-b47d-efd8de611766.png" alt="Dockerfile"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">启动自己容器</span></span><br><span class="line">[root@localhost ~]# docker run -it b63b253b20aa /bin/bash</span><br><span class="line">[root@574f1c6fbf08 /]# ls -l</span><br><span class="line">... ...</span><br><span class="line">drwxr-xr-x.   2 root root   6 Dec 15 03:59 volume01     # 生成镜像时自动挂载的，数据卷目录</span><br><span class="line">drwxr-xr-x.   2 root root   6 Dec 15 03:59 volume02     # 生成镜像时自动挂载的，数据卷目录</span><br></pre></td></tr></table></figure>

<p>这个卷和外部一定有一个同步的目录<code>VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</code>匿名挂载</p>
<p>查看一下卷挂载的路径</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# docker inspect 52f82658de9f</span><br><span class="line">... ...</span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;54bf1866ca5a15d65b12b651e434a3c8ded06d2ff41d1eb030473cd858edeaf6&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/54bf1866ca5a15d65b12b651e434a3c8ded06d2ff41d1eb030473cd858edeaf6/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume01&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;aa602f2da1f83b9f906b6d59e02ac42d3f5a9b0ce7ec860b7b8f0a34b77f112a&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/aa602f2da1f83b9f906b6d59e02ac42d3f5a9b0ce7ec860b7b8f0a34b77f112a/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume02&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        ... ...</span><br><span class="line"><span class="meta"># </span><span class="language-bash">进入容器新建一个文件</span></span><br><span class="line">[root@localhost ~]# docker run -it b63b253b20aa /bin/bash</span><br><span class="line">[root@52f82658de9f /]# cd volume01</span><br><span class="line">[root@52f82658de9f volume01]# touch container.txt</span><br><span class="line"><span class="meta"># </span><span class="language-bash">测试一下新建的文件是否同步出去</span></span><br><span class="line">[root@localhost ~]# cd /var/lib/docker/volumes/54bf1866ca5a15d65b12b651e434a3c8ded06d2ff41d1eb030473cd858edeaf6/_data</span><br><span class="line">[root@localhost _data]# ls</span><br><span class="line">container.txt</span><br></pre></td></tr></table></figure>

<p>假设构建镜像时没有挂载卷，要手动镜像挂载。-v 卷名:容器内路径</p>
<h3 id="7-6-数据卷容器"><a href="#7-6-数据卷容器" class="headerlink" title="7.6 数据卷容器"></a>7.6 数据卷容器</h3><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/27/kuangstudy21c0d7b6-1937-4ba4-a73d-c6c5ffb8c7ff.png" alt="数据容器卷"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">启动3个容器，通过刚才写的镜像启动docker01</span></span><br><span class="line">[root@localhost ~]# docker run -it --name docker01 candy/centos:1.0</span><br><span class="line">[root@ad03105f62e9 /]# ls</span><br><span class="line">bin  etc   lib      lost+found  mnt  proc  run   srv  tmp  var       volume02</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr  volume01</span><br><span class="line">[root@ad03105f62e9 /]# ls -l</span><br><span class="line">... ...</span><br><span class="line">drwxr-xr-x.   2 root root   6 Dec 15 05:50 volume01</span><br><span class="line">drwxr-xr-x.   2 root root   6 Dec 15 05:50 volume02</span><br><span class="line"><span class="meta"># </span><span class="language-bash">创建docker02(02挂载了01，01被称为数据卷容器)，docker02拥有docker01的目录</span></span><br><span class="line">[root@localhost ~]# docker run -it --name docker02 --volumes-from docker01 candy/centos:1.0</span><br><span class="line">[root@655dfe00f902 /]# ls -l</span><br><span class="line">... ...</span><br><span class="line">drwxr-xr-x.   2 root root   6 Dec 15 05:50 volume01</span><br><span class="line">drwxr-xr-x.   2 root root   6 Dec 15 05:50 volume02</span><br><span class="line"><span class="meta"># </span><span class="language-bash">在docker01的目录中创建内容</span></span><br><span class="line">[root@localhost ~]# docker attach ad03105f62e9</span><br><span class="line">[root@ad03105f62e9 /]# cd volume01</span><br><span class="line">[root@ad03105f62e9 volume01]# ls</span><br><span class="line">[root@ad03105f62e9 volume01]# touch docker01</span><br><span class="line">[root@ad03105f62e9 volume01]# ls</span><br><span class="line">docker01</span><br><span class="line"><span class="meta"> # </span><span class="language-bash">会同步到docker02中</span></span><br><span class="line">[root@655dfe00f902 /]# cd volume01</span><br><span class="line">[root@655dfe00f902 volume01]# ls</span><br><span class="line">docker01</span><br><span class="line"><span class="meta"># </span><span class="language-bash">创建docker03，docker03同样拥有docker01的目录和内容</span></span><br><span class="line">[root@localhost _data]# docker run -it --name docker03 --volumes-from docker01 candy/centos:1.0</span><br><span class="line">[root@dba571b389d4 /]# cd volume01</span><br><span class="line">[root@dba571b389d4 volume01]# ls</span><br><span class="line">docker01</span><br><span class="line"><span class="meta"># </span><span class="language-bash">在docker03的目录中创建内容</span></span><br><span class="line">[root@dba571b389d4 volume01]# touch docker03</span><br><span class="line">[root@dba571b389d4 volume01]# ls</span><br><span class="line">docker01  docker03</span><br><span class="line"><span class="meta"># </span><span class="language-bash">会同步到docker01中</span></span><br><span class="line">[root@ad03105f62e9 volume01]# ls</span><br><span class="line">docker01  docker03</span><br></pre></td></tr></table></figure>

<p>只要通过<code>--volumes-from</code>就可以实现容器间的共享</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">测试：可以删除docker01，查看一下docker02和docker03是否还可以访问这个文件</span></span><br><span class="line">[root@localhost ~]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                 CREATED              STATUS               NAMES</span><br><span class="line">dba571b389d4  candy/centos:1.0  &quot;/bin/sh -c /bin/bash&quot;  33 minutes ago   Up 33 minutes    docker03</span><br><span class="line">655dfe00f902   candy/centos:1.0   &quot;/bin/sh -c /bin/bash&quot;   47 minutes ago  Up 47 minutes    docker02</span><br><span class="line">ad03105f62e9   candy/centos:1.0   &quot;/bin/sh -c /bin/bash&quot;   ... ...                                                docker01</span><br><span class="line">[root@localhost ~]# docker rm -f ad03105f62e9</span><br><span class="line">ad03105f62e9</span><br><span class="line"><span class="meta"># </span><span class="language-bash">测试依旧可访问</span></span><br><span class="line">[root@dba571b389d4 volume01]# ls</span><br><span class="line">docker01  docker03</span><br></pre></td></tr></table></figure>

<blockquote>
<p>多个mysql实现数据共享</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost home]# docker run -d -p 3310:3306 -v /etc/mysql/conf.d -v /var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line">[root@localhost home]# docker run -d -p 3310:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-form mysql01 mysql:5.7</span><br><span class="line"><span class="meta"># </span><span class="language-bash">这个时候可以实现两个容器数据同步</span></span><br></pre></td></tr></table></figure>

<p>结论：</p>
<p>容器之间配置信息的传递，数据卷容器的生命周期一直持续到没有容器使用为止。</p>
<p>但是一旦持久化到本地，本地的数据是不会删除的。</p>
<h2 id="8-DockerFile"><a href="#8-DockerFile" class="headerlink" title="8 DockerFile"></a>8 DockerFile</h2><p>DockerFile是用来构建Docker镜像的文件，是命令参数脚本。</p>
<h3 id="8-1-DockerFile介绍"><a href="#8-1-DockerFile介绍" class="headerlink" title="8.1 DockerFile介绍"></a>8.1 DockerFile介绍</h3><blockquote>
<p>构建步骤</p>
</blockquote>
<ul>
<li>编写一个DockerFile文件</li>
<li><code>docker build</code>构建成为一个镜像</li>
<li><code>docker run</code>运行镜像</li>
<li><code>docker push</code>发布镜像（DockerHub、阿里云镜像仓库）</li>
</ul>
<blockquote>
<p>查看官方的DockerFile</p>
</blockquote>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/27/kuangstudyf288b6d8-51c3-4213-b6d6-ef8f4d30d362.png" alt="Dockerfile"></p>
<p>官方镜像都是基础包，很多功能没有，可以自己搭建自己的镜像</p>
<p>官方既然可以制作镜像，我们也可以</p>
<h3 id="8-2-DockerFile构建过程"><a href="#8-2-DockerFile构建过程" class="headerlink" title="8.2 DockerFile构建过程"></a>8.2 DockerFile构建过程</h3><blockquote>
<p>基础知识</p>
</blockquote>
<p>1、每个保留关键字（指令）都必须是大写字母</p>
<p>2、执行从上到下顺序执行</p>
<p>3、# 表示注释</p>
<p>4、每一个指令都会创建提交一个新的镜像层，并提交</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/27/kuangstudyd0ed0707-a816-4d36-9ec5-f94c60caefc6.png" alt="Dockerfile"></p>
<p>DockerFile是面向开发的，以后发布项目，做镜像，就需要编写DockerFile文件，这个文件十分简单</p>
<p>Docker镜像逐渐成为企业交付的标准，必须要掌握</p>
<p>步骤：开发、部署、运维，缺一不可</p>
<p>DockerFile构建文件，定义一切的步骤，源代码</p>
<p>DockerImages通过DockerFile构架生成的镜像，最终发布和运行的产品</p>
<p>Docker容器就是镜像运行起来提供服务</p>
<h3 id="8-3-DockerFile指令"><a href="#8-3-DockerFile指令" class="headerlink" title="8.3 DockerFile指令"></a>8.3 DockerFile指令</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM                   # 基础镜像，一切从这里开始构建    CentOS</span><br><span class="line">MAINTAINER       # 镜像是谁写的，姓名+邮箱</span><br><span class="line">RUN                     # 镜像构建的时候需要运行的命令</span><br><span class="line">ADD                     # 步骤，tomcat镜像，tomcat压缩包，添加内容</span><br><span class="line">WORKDIR            # 镜像的工作目录</span><br><span class="line">VOLUME              # 挂载的目录</span><br><span class="line">EXPOSE                # 保留端口配置</span><br><span class="line">CMD                     # 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代</span><br><span class="line">ENTRYPOINT       # 指定这个容器启动的时候要运行的命令，可以追加命令</span><br><span class="line">ONBULID             # 当构建一个被继承 DockerFile 这个时候就会运行 ONBULID 指令，触发指令</span><br><span class="line">COPY                    # 类似ADD，将我们文件拷贝到镜像中</span><br><span class="line">ENV                      # 构建的时候设置环境变量</span><br></pre></td></tr></table></figure>

<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/27/kuangstudycb4654a2-9447-4aa5-8226-2e64b11d588b.png" alt="Dockerfile"></p>
<h3 id="8-4-实战测试"><a href="#8-4-实战测试" class="headerlink" title="8.4 实战测试"></a>8.4 实战测试</h3><p>Docker Hub中99%镜像都是从这个基础镜像过来的<code>FROM scratch</code>，然后配置需要的软件和配置来进行的构建</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/27/kuangstudy2eb7d22a-95ad-4ad1-bf1d-68a31c0bb875.png" alt="Dockerfile"></p>
<blockquote>
<p>创建一个自己的Centos</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">1、编写Dockerfile文件</span></span><br><span class="line">[root@localhost dockerfile]# cat mydockerfile-centos </span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER candy&lt;2019704946@qq.com&gt;</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;----end----&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="meta"># </span><span class="language-bash">2、通过文件构建镜像</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">命令 docker build -f dockerfile文件路径 -t 镜像名:[tag]</span></span><br><span class="line">[root@localhost dockerfile]# docker build -f mydockerfile-centos -t mycentos:0.1 .</span><br><span class="line">Successfully built 1bd5d6b9029c</span><br><span class="line">Successfully tagged mycentos:0.1</span><br><span class="line"><span class="meta"># </span><span class="language-bash">3、测试运行</span></span><br></pre></td></tr></table></figure>

<p>对比：之前的原生的centos</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/27/kuangstudy0cc2dfd3-27d0-414e-b965-0cb22f122809.jpg" alt="Dockerfile"></p>
<p>我们增加之后的镜像</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/27/kuangstudy80bd9915-9dac-4bc0-b333-10dda20680ab.png" alt="Dockerfile"></p>
<p>可以列出镜像的变更历史</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/27/kuangstudybed169cc-e21b-4f7d-bcdf-5af0e18bc7d4.png" alt="Dockerfile"></p>
<p>拿到镜像可以研究它是怎么做的了</p>
<blockquote>
<p>CMD 和 ENTRYPOINT 区别</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">CMD                 # 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代</span><br><span class="line">ENTRYPOINT    # 指定这个容器启动的时候要运行的命令，可以追加命令</span><br></pre></td></tr></table></figure>

<p><strong>- 测试CMD</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">编写 dockerfile 文件</span></span><br><span class="line">[root@localhost dockerfile]# vi dockerfile-cmd-test</span><br><span class="line">[root@localhost dockerfile]# cat dockerfile-cmd-test </span><br><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta"># </span><span class="language-bash">执行镜像</span></span><br><span class="line">[root@localhost dockerfile]# docker build -f dockerfile-cmd-test -t cmdtest .</span><br><span class="line"><span class="meta"># </span><span class="language-bash">run运行，发现 <span class="built_in">ls</span> -a 命令生效</span></span><br><span class="line">[root@localhost dockerfile]# docker run cdfec2267f91</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"><span class="meta"># </span><span class="language-bash">追加一个命令 -l ，期望的是返回 <span class="built_in">ls</span> -al</span> </span><br><span class="line">[root@localhost dockerfile]# docker run cdfec2267f91 -l</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:380: starting container process caused: exec: &quot;-l&quot;: executable file not found in $PATH: unknown.</span><br><span class="line"><span class="meta"># </span><span class="language-bash">cmd的情况下 -l 替换了 CMD [<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-a&quot;</span>] 命令，-l 不是命令，所以报错</span></span><br></pre></td></tr></table></figure>

<p><strong>- 测试ENTRYPOINT</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">编写 dockerfile 文件</span></span><br><span class="line">[root@localhost dockerfile]# vi dockerfile-cmd-entrypoint</span><br><span class="line">[root@localhost dockerfile]# cat dockerfile-cmd-entrypoint </span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta"># </span><span class="language-bash">执行镜像</span></span><br><span class="line">[root@localhost dockerfile]# docker build -f dockerfile-cmd-entrypoint -t entrypoint-test .</span><br><span class="line"><span class="meta"># </span><span class="language-bash">run运行，发现 <span class="built_in">ls</span> -a 命令生效</span></span><br><span class="line">[root@localhost dockerfile]# docker run b28114dc40da</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"><span class="meta"># </span><span class="language-bash">追加一个命令 -l ，是直接拼接在 ENTRYPOINT 命令的后边</span></span><br><span class="line">[root@localhost dockerfile]# docker run b28114dc40da -l</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x.   1 root root   6 Dec 15 19:27 .</span><br><span class="line">drwxr-xr-x.   1 root root   6 Dec 15 19:27 ..</span><br><span class="line">-rwxr-xr-x.   1 root root   0 Dec 15 19:27 .dockerenv</span><br><span class="line">lrwxrwxrwx.   1 root root   7 Nov  3  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x.   5 root root 340 Dec 15 19:27 dev</span><br><span class="line">drwxr-xr-x.   1 root root  66 Dec 15 19:27 etc</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 home</span><br><span class="line">lrwxrwxrwx.   1 root root   7 Nov  3  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx.   1 root root   9 Nov  3  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------.   2 root root   6 Sep 15 14:17 lost+found</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 media</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 mnt</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 opt</span><br><span class="line">dr-xr-xr-x. 123 root root   0 Dec 15 19:27 proc</span><br><span class="line">dr-xr-x---.   2 root root 162 Sep 15 14:17 root</span><br><span class="line">drwxr-xr-x.  11 root root 163 Sep 15 14:17 run</span><br><span class="line">lrwxrwxrwx.   1 root root   8 Nov  3  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x.   2 root root   6 Nov  3  2020 srv</span><br><span class="line">dr-xr-xr-x.  13 root root   0 Dec 12 16:49 sys</span><br><span class="line">drwxrwxrwt.   7 root root 171 Sep 15 14:17 tmp</span><br><span class="line">drwxr-xr-x.  12 root root 144 Sep 15 14:17 usr</span><br><span class="line">drwxr-xr-x.  20 root root 262 Sep 15 14:17 var</span><br></pre></td></tr></table></figure>

<p>Dockerfile中很多命令都十分的相似，我们需要了解他们的区别，最好的学习就是对比他们然后测试效果</p>
<h3 id="8-5-Tomcat镜像实战"><a href="#8-5-Tomcat镜像实战" class="headerlink" title="8.5 Tomcat镜像实战"></a>8.5 Tomcat镜像实战</h3><blockquote>
<p>1、准备镜像文件Tomcat压缩包，JDK压缩包</p>
</blockquote>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/27/kuangstudyef0d45c5-e2dc-479f-a22f-229cc355fe3e.png" alt="Dockerfile"></p>
<blockquote>
<p>2、编写Dockerfile文件，官方命名&#x3D;&#x3D;Dockerfile&#x3D;&#x3D;，build会自动寻找这个文件，就不需要-f指定了</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER candy&lt;2019704946@qq.com&gt;</span><br><span class="line">COPY readme.txt /usr/local/readme.txt</span><br><span class="line">ADD jdk-8u11-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-9.0.22.tar.gz /usr/local/</span><br><span class="line"><span class="meta"># </span><span class="language-bash">RUN yum -y install vim</span></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_11</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/rt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.22</span><br><span class="line">ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.22</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line">EXPOSE 8080</span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.22/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.22/logs/catalina.out</span><br></pre></td></tr></table></figure>

<blockquote>
<p>3、构建镜像</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost tomcat]# docker build -t diytomcat .</span><br></pre></td></tr></table></figure>

<blockquote>
<p>4、启动镜像</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># 启动镜像</span><br><span class="line">[root@localhost tomcat]# docker run -d -p 9090:8080 --name candytomcat -v /home//home/tomcat/tomcatlogs/:/usr/local/apache-tomcat-9.0.22/logs diytomcat</span><br><span class="line">3c4ca4f0c5c70bbb0875652810658a986d5894b78fe996c596a409fdf0d1204e</span><br><span class="line"># 进入镜像</span><br><span class="line">[root@localhost tomcat]# docker exec -it 3c4ca4f0c5c70bbb087565 /bin/bash</span><br></pre></td></tr></table></figure>

<blockquote>
<p>5、访问测试</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">本地测试</span></span><br><span class="line">[root@localhost tomcat]# curl localhost:9090</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">        &lt;title&gt;Apache Tomcat/9.0.22&lt;/title&gt;</span><br><span class="line">        &lt;link href=&quot;favicon.ico&quot; rel=&quot;icon&quot; type=&quot;image/x-icon&quot; /&gt;</span><br><span class="line">        &lt;link href=&quot;favicon.ico&quot; rel=&quot;shortcut icon&quot; type=&quot;image/x-icon&quot; /&gt;</span><br><span class="line">        &lt;link href=&quot;tomcat.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">    ... ...</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta"># </span><span class="language-bash">外网测试</span></span><br></pre></td></tr></table></figure>

<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/27/kuangstudy5da81be9-a0ca-48d2-b653-1de1013956ad.png" alt="Dockerfile"></p>
<blockquote>
<p>6、发布项目（由于做了卷挂载，直接在本地编写项目就可以发布了）</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost tomcat]# cd test</span><br><span class="line">[root@localhost test]# mkdir WEB-INF</span><br><span class="line">[root@localhost test]# cd WEB-INF</span><br><span class="line">[root@localhost WEB-INF]# vi web.xml</span><br><span class="line">[root@localhost test]# vi index.jsp</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;web-app xmlns=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span></span><br><span class="line">            xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">                  xsi:schemaLocation=<span class="string">&quot;http://java.sun.com/xml/ns/javaee</span></span><br><span class="line"><span class="string">                                                     http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span></span><br><span class="line">                  version=<span class="string">&quot;2.5&quot;</span>&gt;</span><br><span class="line"> &lt;/web-app&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span><br><span class="line">    pageEncoding=<span class="string">&quot;UTF-8&quot;</span>%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">        &lt;title&gt;Hello,Candy&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        Hello World!&lt;br/&gt;</span><br><span class="line">        &lt;%</span><br><span class="line">        System.out.println(<span class="string">&quot;----My test web logs----&quot;</span>);</span><br><span class="line">        %&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>





<p>发现：项目部署成功，可以直接访问！</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/27/kuangstudyb1a4c3b5-03bb-4624-848b-d76cc89251a1.png" alt="Dockerfile"></p>
<p>以后开发的步骤：需要掌握Dockerfile的编写！之后的一切都是使用Docker镜像来发布运行！</p>
<h3 id="8-6-发布镜像"><a href="#8-6-发布镜像" class="headerlink" title="8.6 发布镜像"></a>8.6 发布镜像</h3><blockquote>
<p>DockerHub</p>
</blockquote>
<p>1.地址 <a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a> 注册自己的账号</p>
<p>2.确定这个账号可以登录<br>3.在服务器上提交自己的镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# docker login --help</span><br><span class="line">Usage:  docker login [OPTIONS] [SERVER]</span><br><span class="line">Log in to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br></pre></td></tr></table></figure>

<p>4.登录完毕后提交镜像</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">登录</span></span><br><span class="line">[root@localhost ~]# docker login -u candy821</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line">Login Succeeded</span><br><span class="line"><span class="meta"># </span><span class="language-bash">提交镜像，带上版本号，否则会被拒绝</span></span><br><span class="line">[root@localhost ~]# docker push diytomcat</span><br><span class="line">Using default tag: latest</span><br><span class="line">The push refers to repository [docker.io/library/diytomcat]</span><br><span class="line">3514cac4541c: Preparing </span><br><span class="line">b9a3a8ee3650: Preparing </span><br><span class="line">aac332cceb25: Preparing </span><br><span class="line">74ddd0ec08fa: Preparing </span><br><span class="line">denied: requested access to the resource is denied    # 被拒绝</span><br><span class="line"><span class="meta"># </span><span class="language-bash">解决，重新命名</span></span><br><span class="line">[root@localhost ~]# docker push candy821/diytomcat:1.0</span><br><span class="line">The push refers to repository [docker.io/candy821/diytomcat]</span><br><span class="line">An image does not exist locally with the tag: candy821/diytomcat</span><br><span class="line"><span class="meta"># </span><span class="language-bash">重新命名再提交</span></span><br><span class="line">[root@localhost ~]# docker tag 89f2a31cc01a candy821/tomcat:1.0</span><br><span class="line">[root@localhost ~]# docker push candy821/tomcat:1.0</span><br><span class="line">The push refers to repository [docker.io/candy821/tomcat]</span><br><span class="line">3514cac4541c: Pushed </span><br><span class="line">b9a3a8ee3650: Pushed </span><br><span class="line">aac332cceb25: Pushed </span><br><span class="line">74ddd0ec08fa: Pushed </span><br><span class="line">1.0: digest: sha256:73540a37afd6060c8989966e0bdc4f9b2906319ce3ed0fe3ba50d11c1ee71bc4 size: 1161</span><br></pre></td></tr></table></figure>

<p>5.退出登录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# docker logout</span><br></pre></td></tr></table></figure>

<blockquote>
<p>阿里云镜像(本人没有阿里云，所以这个地方不写了)</p>
</blockquote>
<p>1.登录阿里云<br>2.找到镜像服务<br>3.创建命名空间<br>4.创建容器镜像<br>5.浏览页面信息</p>
<h2 id="9-小结"><a href="#9-小结" class="headerlink" title="9 小结"></a>9 小结</h2><p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/29/kuangstudydfed7e28-ccb3-4ee4-a25b-a1f4f7ec474b.png" alt="Docker总结"></p>
<h2 id="10-Docker网络"><a href="#10-Docker网络" class="headerlink" title="10 Docker网络"></a>10 Docker网络</h2><h3 id="10-1-理解Docker网络"><a href="#10-1-理解Docker网络" class="headerlink" title="10.1 理解Docker网络"></a>10.1 理解Docker网络</h3><blockquote>
<p>清空所有环境</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">删除所有容器</span></span><br><span class="line">[root@localhost ~]# docker rm -f $(docker ps -aq)</span><br><span class="line"><span class="meta"># </span><span class="language-bash">删除所有镜像</span></span><br><span class="line">[root@localhost ~]# docker rmi -f $(docker images -aq)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Docker是如何处理容器网络访问的</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">运行容器</span></span><br><span class="line">[root@localhost ~]# docker run -d -P --name tomcat01 tomcat</span><br><span class="line"><span class="meta"># </span><span class="language-bash">查看容器内部网络地址</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">若没有被阉割命令</span></span><br><span class="line">[root@localhost ~]# docker exec -it tomcat01 ip addr</span><br><span class="line"><span class="meta"># </span><span class="language-bash">若被阉割命令，先进入容器</span></span><br><span class="line">[root@localhost ~]# docker exec -it tomcat01 /bin/bash</span><br><span class="line"><span class="meta"># </span><span class="language-bash">再查看</span></span><br><span class="line">root@3e7a784d1d49:/usr/local/tomcat# cat /etc/hosts</span><br><span class="line">127.0.0.1    localhost</span><br><span class="line">::1    localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0    ip6-localnet</span><br><span class="line">ff00::0    ip6-mcastprefix</span><br><span class="line">ff02::1    ip6-allnodes</span><br><span class="line">ff02::2    ip6-allrouters</span><br><span class="line">172.17.0.2    3e7a784d1d49</span><br><span class="line"><span class="meta"># </span><span class="language-bash">Linux能不能ping通容器内部</span></span><br><span class="line">[root@localhost ~]# ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.065 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.071 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.127 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=4 ttl=64 time=0.050 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=5 ttl=64 time=0.060 ms</span><br><span class="line">... ...</span><br><span class="line"><span class="meta"># </span><span class="language-bash">Linux可以ping通docker容器内部</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>原理</p>
</blockquote>
<p>1.每启动一个Docker容器，Docker就会给Docker容器分配一个IP，只要安装了Docker，就会有一个网卡Docker桥接模式，使用的技术是 evth-pair技术再次测试ip addr</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/29/kuangstudy89c8fceb-a67b-4775-93bb-9e8c9cbdde63.png" alt="Docker网络"></p>
<p>2.在启动一个容器测试，发现又多了一对网卡</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/29/kuangstudy4ee257b9-6541-4d9f-ad42-44582d3bf4c3.png" alt="Docker网络"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">发现这个容器带来的网卡，都是一对一对的</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">evth-pair 就是一对虚拟设备接口，他们都是成对出现的，一端连着协议，一端彼此相连</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">正因为有这个特性，evth-pair 充当一个桥梁，连接各种虚拟网络设备的</span></span><br><span class="line"><span class="meta"># </span><span class="language-bash">OpenStac，Docker容器之间的连接，OVS的连接，都是使用 evth-pair 技术</span></span><br></pre></td></tr></table></figure>

<p>3.测试 tomcat01 和 tomcat02 是否可以ping通</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# docker exec -it tomcat02 ping 172.17.0.2</span><br><span class="line"><span class="meta"># </span><span class="language-bash">结论：容器和容器之间是可以互相ping通的</span></span><br></pre></td></tr></table></figure>

<p>绘制一个网络模型图：</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/29/kuangstudy413f4fca-d089-485a-a3dd-d12f4bdc132f.png" alt="Docker网络"></p>
<p>- 结论：Tomcat01和Tomcat02是公用的一个路由器，Docker0。</p>
<p>所有的容器不指定网络的情况下，都是Docker0路由的，Docker会给我们的容器分配一个默认的可用IP。</p>
<blockquote>
<p>小结</p>
</blockquote>
<p>Docker使用的是Linux的桥接，宿主机是一个Docker容器的网桥</p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/29/kuangstudy9878678f-8608-441b-8a7e-072d0e717204.png" alt="Docker网络"></p>
<p>Docker中的所有的网络接口都是虚拟的，虚拟的转发效率高！(内网传递文件！)</p>
<p>只要容器删除，对应网桥一对就没了。</p>
<h3 id="10-2-—link"><a href="#10-2-—link" class="headerlink" title="10.2 —link"></a>10.2 —link</h3><blockquote>
<p>思考一个场景：我们编写了一个微服务，database url&#x3D;ip: ，项目不重启，数据库ip换了，我们希望可以处理这个问题，可以通过名字来进行访问容器？</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">如何可以解决呢？</span></span><br><span class="line">[root@localhost ~]# docker exec -it tomcat02 ping tomcat01</span><br><span class="line">ping: tomcat01: Name or service not known</span><br><span class="line"><span class="meta"># </span><span class="language-bash">通过 --<span class="built_in">link</span> 就可以解决网络连通问题</span></span><br><span class="line">[root@localhost ~]# docker run -d -P --name tomcat03 --link tomcat02 tomcat</span><br><span class="line">8d727b26b070698d3a84db2b6269f1a86edbb1c110a23c2733addef16f6e3bef</span><br><span class="line">[root@localhost ~]# docker exec -it tomcat03 ping tomcat02</span><br><span class="line"><span class="meta"># </span><span class="language-bash">反向可以ping通吗</span></span><br><span class="line">[root@localhost ~]# docker exec -it tomcat02 ping tomcat03</span><br><span class="line">ping: tomcat03: Name or service not known</span><br></pre></td></tr></table></figure>

<p>- 探究：<code>docker network inspect bridge</code></p>
<p><img src="https://kuangstudy.oss-cn-beijing.aliyuncs.com/bbs/2021/12/29/kuangstudye4b9c132-753c-489f-b6b1-7dfcf1410a02.png" alt="Docker网络"></p>
<p>其实这个tomcat03就是在本地配置了tomcat02的配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"># </span><span class="language-bash">查看 hosts 配置，原理发现</span></span><br><span class="line">[root@localhost ~]# docker exec -it tomcat03 cat /etc/hosts</span><br><span class="line">127.0.0.1    localhost</span><br><span class="line">::1    localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0    ip6-localnet</span><br><span class="line">ff00::0    ip6-mcastprefix</span><br><span class="line">ff02::1    ip6-allnodes</span><br><span class="line">ff02::2    ip6-allrouters</span><br><span class="line">172.17.0.3    tomcat02 6846b34d8575</span><br><span class="line">172.17.0.4    8d727b26b070</span><br></pre></td></tr></table></figure>

<blockquote>
<p>本质探究</p>
</blockquote>
<p><strong>—link</strong>就是我们在hosts配置中增加了一个<code>172.17.0.3 tomcat02 6846b34d8575</code>的映射，但是现在学习Docker已经不建议使用 —link 了，自定义网络不适用于Docker0！！！</p>
<p>Docker0问题：不支持容器名连接访问</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Joker</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.liksn.cn/2022/02/17/Docker%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">http://www.liksn.cn/2022/02/17/Docker学习笔记/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.liksn.cn" target="_blank">Joker'S Blog 3.0</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Docker/">Docker</a><a class="post-meta__tags" href="/tags/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/">容器技术</a></div><div class="post_share"><div class="social-share" data-image="https://static.talkxj.com/articles/a31d598cf1676b21787639326084d918.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" src="/img/alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/02/17/ElasticSearch%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><img class="prev-cover" src="https://static.talkxj.com/articles/771941739cbc70fbe40e10cf441e02e5.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ElasticSearch学习笔记</div></div></a></div><div class="next-post pull-right"><a href="/2022/02/17/Linux%EF%BC%9A%E5%B8%B8%E7%94%A8%E7%9A%84%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4/"><img class="next-cover" src="https://static.talkxj.com/articles/3dffb2fcbd541886616ab54c92570de3.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Linux：常用的基本命令</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC81NTUxMS8zMTk3OA"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://101.43.3.47/static/attach/20220212/f867e104147a450d83f314dcb37f2624.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Joker</div><div class="author-info__description">Joker的个人博客3.0</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/HG-JOk"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is Joker‘s Blog & 3.0(bate)</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Docker%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">1 Docker概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-Docker%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%87%BA%E7%8E%B0"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 Docker为什么会出现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Docker%E7%9A%84%E5%8E%86%E5%8F%B2"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 Docker的历史</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Docker%E8%83%BD%E5%B9%B2%E5%98%9B"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 Docker能干嘛</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Docker%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">2 Docker安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-Docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 Docker的基本组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%AE%89%E8%A3%85Docker-%E9%80%82%E7%94%A8%E4%BA%8EVMware"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 安装Docker(适用于VMware)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E5%8D%B8%E8%BD%BDDocker"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 卸载Docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 阿里云镜像加速</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E5%9B%9E%E9%A1%BEHello-World%E6%B5%81%E7%A8%8B"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 回顾Hello World流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">2.6.</span> <span class="toc-text">2.6 底层原理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Docker%E7%9A%84%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.</span> <span class="toc-text">3 Docker的常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4%E5%92%8C%E6%96%87%E6%A1%A3"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 帮助命令和文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 镜像命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 容器命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-%E5%B8%B8%E7%94%A8%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 常用其他命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-%E4%BD%9C%E4%B8%9A%E7%BB%83%E4%B9%A0"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 作业练习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Portainer%E5%8F%AF%E8%A7%86%E5%8C%96%E9%9D%A2%E6%9D%BF%E5%AE%89%E8%A3%85"><span class="toc-number">4.</span> <span class="toc-text">4 Portainer可视化面板安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Docker%E9%95%9C%E5%83%8F%E8%AE%B2%E8%A7%A3"><span class="toc-number">5.</span> <span class="toc-text">5 Docker镜像讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E9%95%9C%E5%83%8F%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">5.1.</span> <span class="toc-text">5.1 镜像是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-Docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">5.2.</span> <span class="toc-text">5.2 Docker镜像加载原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E5%88%86%E5%B1%82%E7%90%86%E8%A7%A3"><span class="toc-number">5.3.</span> <span class="toc-text">5.3 分层理解</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Commit%E9%95%9C%E5%83%8F"><span class="toc-number">6.</span> <span class="toc-text">6 Commit镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">7.</span> <span class="toc-text">7 容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">7.1.</span> <span class="toc-text">7.1 什么是容器数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">7.2.</span> <span class="toc-text">7.2 使用数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E5%AE%89%E8%A3%85MySQL"><span class="toc-number">7.3.</span> <span class="toc-text">7.3 安装MySQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E5%85%B7%E5%90%8D%E5%92%8C%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">7.4.</span> <span class="toc-text">7.4 具名和匿名挂载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-%E5%88%9D%E8%AF%86Dockerfile"><span class="toc-number">7.5.</span> <span class="toc-text">7.5 初识Dockerfile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">7.6.</span> <span class="toc-text">7.6 数据卷容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-DockerFile"><span class="toc-number">8.</span> <span class="toc-text">8 DockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-DockerFile%E4%BB%8B%E7%BB%8D"><span class="toc-number">8.1.</span> <span class="toc-text">8.1 DockerFile介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-DockerFile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">8.2.</span> <span class="toc-text">8.2 DockerFile构建过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-DockerFile%E6%8C%87%E4%BB%A4"><span class="toc-number">8.3.</span> <span class="toc-text">8.3 DockerFile指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-%E5%AE%9E%E6%88%98%E6%B5%8B%E8%AF%95"><span class="toc-number">8.4.</span> <span class="toc-text">8.4 实战测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-Tomcat%E9%95%9C%E5%83%8F%E5%AE%9E%E6%88%98"><span class="toc-number">8.5.</span> <span class="toc-text">8.5 Tomcat镜像实战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-%E5%8F%91%E5%B8%83%E9%95%9C%E5%83%8F"><span class="toc-number">8.6.</span> <span class="toc-text">8.6 发布镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%B0%8F%E7%BB%93"><span class="toc-number">9.</span> <span class="toc-text">9 小结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-Docker%E7%BD%91%E7%BB%9C"><span class="toc-number">10.</span> <span class="toc-text">10 Docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E7%90%86%E8%A7%A3Docker%E7%BD%91%E7%BB%9C"><span class="toc-number">10.1.</span> <span class="toc-text">10.1 理解Docker网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-%E2%80%94link"><span class="toc-number">10.2.</span> <span class="toc-text">10.2 —link</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/02/17/Vue-%E4%B8%AD%E6%B7%BB%E5%8A%A0-lottie-%E5%8A%A8%E7%94%BB/" title="Vue 中添加 lottie 动画"><img src="https://static.talkxj.com/articles/a31d598cf1676b21787639326084d918.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Vue 中添加 lottie 动画"/></a><div class="content"><a class="title" href="/2022/02/17/Vue-%E4%B8%AD%E6%B7%BB%E5%8A%A0-lottie-%E5%8A%A8%E7%94%BB/" title="Vue 中添加 lottie 动画">Vue 中添加 lottie 动画</a><time datetime="2022-02-17T04:02:28.000Z" title="发表于 2022-02-17 12:02:28">2022-02-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/17/%E5%A6%82%E4%BD%95%E6%8A%8A%E9%83%A8%E7%BD%B2%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84springboot%E9%A1%B9%E7%9B%AE%E6%8C%81%E7%BB%AD%E5%9C%A8%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C-%E6%97%A7%E7%89%88/" title="如何把部署到服务器上的springboot项目持续在后台运行(旧版)"><img src="https://static.talkxj.com/articles/a31d598cf1676b21787639326084d918.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="如何把部署到服务器上的springboot项目持续在后台运行(旧版)"/></a><div class="content"><a class="title" href="/2022/02/17/%E5%A6%82%E4%BD%95%E6%8A%8A%E9%83%A8%E7%BD%B2%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E7%9A%84springboot%E9%A1%B9%E7%9B%AE%E6%8C%81%E7%BB%AD%E5%9C%A8%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C-%E6%97%A7%E7%89%88/" title="如何把部署到服务器上的springboot项目持续在后台运行(旧版)">如何把部署到服务器上的springboot项目持续在后台运行(旧版)</a><time datetime="2022-02-17T04:01:03.000Z" title="发表于 2022-02-17 12:01:03">2022-02-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/17/Springboot%E4%B8%ADPageHelper-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" title="Springboot中PageHelper 分页查询使用方法"><img src="https://static.talkxj.com/articles/ceb6402f4d22c463638533577f54619b.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Springboot中PageHelper 分页查询使用方法"/></a><div class="content"><a class="title" href="/2022/02/17/Springboot%E4%B8%ADPageHelper-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" title="Springboot中PageHelper 分页查询使用方法">Springboot中PageHelper 分页查询使用方法</a><time datetime="2022-02-17T03:59:00.000Z" title="发表于 2022-02-17 11:59:00">2022-02-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/17/SpringCloud%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="SpringCloud学习笔记"><img src="https://static.talkxj.com/articles/a31d598cf1676b21787639326084d918.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringCloud学习笔记"/></a><div class="content"><a class="title" href="/2022/02/17/SpringCloud%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="SpringCloud学习笔记">SpringCloud学习笔记</a><time datetime="2022-02-17T03:57:59.000Z" title="发表于 2022-02-17 11:57:59">2022-02-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/02/17/Linux%E5%B8%B8%E7%94%A8%E4%B8%89%E7%A7%8D%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F%E5%8F%8A%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" title="Linux常用三种软件安装方式及服务器基本环境搭建"><img src="https://static.talkxj.com/articles/7cdd5d97ce85a65988f510ff79c90e46.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux常用三种软件安装方式及服务器基本环境搭建"/></a><div class="content"><a class="title" href="/2022/02/17/Linux%E5%B8%B8%E7%94%A8%E4%B8%89%E7%A7%8D%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E6%96%B9%E5%BC%8F%E5%8F%8A%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9F%BA%E6%9C%AC%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" title="Linux常用三种软件安装方式及服务器基本环境搭建">Linux常用三种软件安装方式及服务器基本环境搭建</a><time datetime="2022-02-17T03:56:49.000Z" title="发表于 2022-02-17 11:56:49">2022-02-17</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://static.talkxj.com/articles/a31d598cf1676b21787639326084d918.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Joker</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">赣ICP备2022000890号</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadLivere () {
  if (typeof LivereTower === 'object') {
    window.LivereTower.init()
  }
  else {
    (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
    })(document, 'script');
  }
}

if ('Livere' === 'Livere' || !false) {
  if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
  else loadLivere()
}
else {
  function loadOtherComment () {
    loadLivere()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script>window.$crisp = [];
window.CRISP_WEBSITE_ID = "28b1cda6-6704-4a5a-ad34-a8b0c0c95df9";
(function () {
  d = document;
  s = d.createElement("script");
  s.src = "https://client.crisp.chat/l.js";
  s.async = 1;
  d.getElementsByTagName("head")[0].appendChild(s);
})();
$crisp.push(["safe", true])

if (false) {
  $crisp.push(["do", "chat:hide"])
  $crisp.push(["on", "chat:closed", function() {
    $crisp.push(["do", "chat:hide"])
  }])
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      $crisp.push(["do", "chat:show"])
      $crisp.push(["do", "chat:open"])

    });
  }
  chatBtnFn()
} else {
  if (false) {
    function chatBtnHide () {
      $crisp.push(["do", "chat:hide"])
    }
    function chatBtnShow () {
      $crisp.push(["do", "chat:show"])
    }
  }
}</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>